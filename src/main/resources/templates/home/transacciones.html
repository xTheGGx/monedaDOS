<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es" class="light">
<head th:replace="~{fragments/layout :: headFrag('Transacciones')}"></head>
<body>
<div class="page-wrapper">
    <div th:replace="~{fragments/layout :: navbar('tx')}"></div>

    <main class="container main-content">
        <div class="main-headline" style="align-items: center;">
            <div>
                <h1>Transacciones</h1>
                <p class="subtitle">Consulta, filtra y registra todos tus movimientos.</p>
            </div>
            <button class="button-primary" id="btn-open-sidebar">
                <span class="material-symbols-outlined">add</span>
                Registrar Movimiento
            </button>
        </div>

        <div class="card" style="margin-bottom: 1.5rem;">
            <h3 class="card-title">Filtros</h3>
            <form class="filter-form">
                <div class="form-group">
                    <label for="filtro-mes">Mes</label>
                    <select id="filtro-mes" class="form-select">
                        <option>Octubre 2024</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="filtro-tipo">Tipo</label>
                    <select id="filtro-tipo" class="form-select">
                        <option>Todos</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="filtro-cat">Categoría</label>
                    <select id="filtro-cat" class="form-select">
                        <option>Todas</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="filtro-cuenta">Cuenta</label>
                    <select id="filtro-cuenta" class="form-select">
                        <option>Todas</option>
                    </select>
                </div>
                <button class="button-secondary" type="submit">Filtrar</button>
            </form>
        </div>

        <div class="card transactions-card">
            <h3 class="card-title">Historial de Movimientos</h3>
            <div class="table-container">
                <table class="transactions-table">
                    <thead>
                    <tr>
                        <th>Fecha</th>
                        <th>Descripción</th>
                        <th class="col-desktop">Categoría</th>
                        <th class="col-desktop">Cuenta</th>
                        <th class="col-right">Monto</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td class="text-muted">23 Oct</td>
                        <td class="text-main">Supermercado "Ohana"</td>
                        <td class="col-desktop"><span class="badge badge-blue">Comida</span></td>
                        <td class="col-desktop text-muted">Cta. Principal</td>
                        <td class="col-right text-expense">-$125.50</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <div th:replace="~{fragments/layout :: footer}"></div>
</div>

<div class="sidebar-overlay" id="sidebar-overlay"></div>

<aside class="sidebar-form" id="register-sidebar">
    <div class="sidebar-header">
        <h3>Registrar Movimiento</h3>
        <button class="sidebar-close" id="btn-close-sidebar">×</button>
    </div>

    <form class="sidebar-content" th:action="@{/transacciones}" method="post" th:object="${transaccionDTO}">

        <input th:if="${_csrf != null}" type="hidden"
               th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

        <input type="hidden" id="tipoMovimiento" name="tipoMovimiento" value="INGRESO" />

        <div class="form-group">
            <label>Tipo de movimiento</label>
            <div class="tipo-movimiento">
                <button type="button" class="tipo-btn ingreso active" id="btn-ingreso">
                    <span class="material-symbols-outlined">add</span> Ingreso
                </button>
                <button type="button" class="tipo-btn gasto" id="btn-gasto">
                    <span class="material-symbols-outlined">remove</span> Gasto
                </button>
            </div>
        </div>
        
        <div class="form-group">
            <label for="sidebar-monto">Monto</label>
            <input type="number" step="0.01" th:field="*{monto}" class="form-input" placeholder="0.00" required/>
        </div>
        
        <div class="form-group">
            <label for="sidebar-desc">Descripción</label>
            <input type="text" th:field="*{descripcion}" class="form-input" placeholder="Ej: Café de la mañana" maxlength="255"/>
        </div>
        
        <div class="form-group">
            <label for="sidebar-cat">Categoría</label>
            <select id="sidebar-cat" th:field="*{categoriaId}" class="form-select" required>
                <option value="" disabled selected>Selecciona una categoría</option>
                <th:block th:each="cat : ${categorias}">
                    <option th:value="${cat.idCategoria}"
                            th:text="${cat.nombre}"
                            th:attr="data-tipo=${cat.tipo.name()}"
                            th:style="${cat.tipo.name() == 'EGRESO'} ? 'display:none;' : ''"
                    ></option>
                </th:block>
            </select>
        </div>
        
        <div class="form-group">
            <label for="sidebar-cuenta">Cuenta</label>
            <select id="sidebar-cuenta" th:field="*{cuentaId}" class="form-select" required>
                 <option value="" disabled selected>Selecciona una cuenta</option>
                 <option th:each="cta : ${cuentas}"
                         th:value="${cta.idCuenta}"
                         th:text="${cta.nombre}"></option>
            </select>
        </div>
        
        <p class="form-msg success" th:if="${created}" th:text="${created}"></p>
        <p class="form-msg error" th:if="${error}" th:text="${error}"></p>

        <button class="button-primary" type="submit" style="width: 100%; justify-content: center; margin-top: auto;">
            Guardar Movimiento
        </button>
    </form>
    
    <div class="sidebar-footer">
        <img alt="Stitch dando un consejo financiero" class="tip-img"
             src="https://lh3.googleusercontent.com/aida-public/AB6AXuAOydcRyhWfE9_E8WF9AWM145JIV4rxGOdPStTwAcIH1alwmY-uYVd0bipBm5JmOWu8fG9nmE01Q2n7ObXNpVcCM5CJaohkJ3HfbxsxlmAzCxSS1ntZSTCeynqmvIHBusVb4ftLS5KbmUDkPn9-Xq0NYYov4I0c5VZ4c-Ff4mp2y5kVvJAq0w4hKEsb8bl0vbtNNGOUFSLvW5dDtVWNVMXRS4x1nNMVLTMqwqe9op5A55YmTyxKTPrSAhEqvWzTUKHLXwN0Hqzen9U"/>
        <div>
            <h4>¡Registra sin miedo!</h4>
            <p>Todo movimiento, grande o pequeño, te ayuda a tomar el control.</p>
        </div>
    </div>
</aside>

<script th:src="@{/js/scripts.js}" defer></script>
</body>
</html>