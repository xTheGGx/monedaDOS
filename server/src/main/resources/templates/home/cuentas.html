<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es" class="light">
<head th:with="pageCssHref=@{/css/pages/cuentas.css}"
      th:replace="~{fragments/layout :: headFrag('Cuentas')}"></head>


<body>
<div class="page-wrapper">
    <div th:replace="~{fragments/layout :: navbar('cuentas')}"></div>
    <main class="container main-content">
        <div class="main-headline">
            <div>
                <h1>Gestión de Cuentas</h1>
                <p class="subtitle">Aquí están todas tus cuentas, ¡bien organizadas!</p>
            </div>
            <div class="totals">
                <span class="kpi-label">Saldo total</span>
                <strong th:text="${#numbers.formatDecimal(saldoTotal,1,'COMMA',2,'POINT')}"></strong>
            </div>
        </div>

        <div class="accounts-grid">
            <div class="card account-card" th:each="c : ${cuentas}">
                <div class="account-card-header">
                    <h3 th:text="${c.nombre}">Nombre Cuenta</h3>
                    <span class="badge-faint"
                          th:classappend="${c.tipo.name()=='CREDITO'} ? ' badge-faint-red' : ' badge-faint-green'"
                          th:text="${c.tipo}">DEBITO</span>
                </div>

                <p class="account-bank" th:text="${c.moneda}">MXN</p>

                <p class="account-balance"
                   th:classappend="${c.saldo < 0} ? ' text-expense' : ''"
                   th:text="${#numbers.formatDecimal(c.saldo,1,'COMMA',2,'POINT')}">
                    $0.00
                </p>

                <div class="account-credit-details" th:if="${c.tipo.name()=='CREDITO'}">
                    <small>
                        Corte: <span th:text="${c.diaCorte != null ? c.diaCorte : '-'}">-</span> ·
                        Pago: <span th:text="${c.diaPago  != null ? c.diaPago  : '-'}">-</span>
                        <span th:if="${c.limiteCredito != null}">
          · Límite: <span th:text="${#numbers.formatDecimal(c.limiteCredito,1,'COMMA',2,'POINT')}"></span>
        </span>
                    </small>
                </div>

                <div class="account-card-footer">
                    <a class="button-link" th:href="@{|/transacciones?cuenta=${c.idCuenta}|}">Ver movimientos</a>

                    <button class="button-primary-small" disabled>Editar</button>
                </div>
            </div>


            <div class="card account-card-add" id="btn-open-add-account">
                <span class="material-symbols-outlined">add_circle</span>
                <strong>Agregar Nueva Cuenta</strong>
                <p>Añade una cuenta de débito, crédito o de inversión.</p>
            </div>
        </div>
    </main>
    <div th:replace="~{fragments/layout :: footer}"></div>
</div>
<!-- Overlay -->
<div class="sidebar-overlay" id="add-account-overlay"></div>

<!-- Sidebar Añadir Cuenta -->
<aside class="sidebar-form" id="add-account-sidebar" aria-hidden="true">
    <div class="sidebar-header">
        <h3>Añadir Cuenta</h3>
        <button class="sidebar-close" id="btn-close-add-account" aria-label="Cerrar">&times;</button>
    </div>

    <!-- Contenido desplazable del panel -->
    <div class="sidebar-content">
        <form th:action="@{/cuentas}" method="post" th:object="${cuentaDTO}" class="form-grid">

            <!-- CSRF -->
            <input th:if="${_csrf != null}" type="hidden"
                   th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

            <div class="form-field">
                <label for="cuenta-nombre">Nombre</label>
                <input id="cuenta-nombre" type="text" th:field="*{nombre}"
                       placeholder="Mi Débito / Mi Visa" required maxlength="100">
            </div>

            <div class="form-field">
                <label for="cuenta-tipo">Tipo</label>
                <select id="cuenta-tipo" th:field="*{tipo}" required>
                    <option th:each="t : ${tipos}" th:value="${t}" th:text="${t}"></option>
                </select>
            </div>

            <!-- Campos exclusivos de crédito -->
            <div class="form-inline-2 credit-only" id="credit-fields">
                <div class="form-field">
                    <label for="cuenta-corte">Día de corte</label>
                    <input id="cuenta-corte" type="number" th:field="*{diaCorte}" min="1" max="31" placeholder="15">
                </div>
                <div class="form-field">
                    <label for="cuenta-pago">Día de pago</label>
                    <input id="cuenta-pago" type="number" th:field="*{diaPago}" min="1" max="31" placeholder="2">
                </div>
            </div>

            <div class="form-field credit-only">
                <label for="cuenta-limite">Límite de crédito (opcional)</label>
                <input id="cuenta-limite" type="number" step="0.01"
                       th:field="*{limiteCredito}" placeholder="20000.00">
            </div>

            <div class="sidebar-footer no-border">
                <button type="submit" class="button-primary w-full">Guardar</button>
            </div>

            <p class="form-msg success" th:if="${created}">¡Cuenta creada!</p>
            <p class="form-msg error" th:if="${error}" th:text="${error}"></p>
        </form>
    </div>

    <!-- Pie informativo (igual que en “Registrar Movimiento”) -->
    <div class="sidebar-footer tip">
        <img src="/images/pet_sit-.png" alt="" width="48" height="48" loading="lazy">
        <div>
            <strong>¡Cuentas claras!</strong>
            <p>Agrega todas tus cuentas para ver tu saldo total.</p>
        </div>
    </div>
</aside>

<script th:src="@{/js/scripts.js}" defer></script>
</body>
</html>
